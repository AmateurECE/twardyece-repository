---
title: Git
---

# Remove some files from all commits

WARNING: This command will rewrite history, and it will automatically push
updates to the remote. This tool is probably not already installed on your
system. On Arch Linux, the package is called `git-filter-repo`.

```bash-session
git filter-repo --invert-paths --path filename
```

# Rebase onto root commit

Use the `--root` option to Git to allow rebasing onto the root commit.

```bash-session
$ git rebase --root
```

The `-i` flag will do this interactively, of course. If there is not currently
an upstream branch, this flag takes the branch name as a parameter.

```bash-session
$ git rebase -i trunk --root
```

# Sort Branches by Most Recently Updated

Replace `refs/heads/` with `refs/remotes/` to see remote branches.

```bash-session
$ git for-each-ref --sort=committerdate refs/heads/ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) (%(color:green)%(committerdate:relative)%(color:reset))'
```

# Advanced Stash Operations

Show the contents of the stash using `git stash show [-p]`. There are also
aliases for the stash refs in the local checkout, which allows use of
`git-diff` to inspect the stash:

```
# View changes to `a.file` in the topmost stash entry
git diff stash@{0}^1 stash@{0} -- a.file
```

Running `git stash show` without `-p` will show the diff in "short form"--that
is, only the paths of the files that have changed, and not the content.
Finally, running `git stash list` will show the entries in the stash.

Sometimes, popping an entry from the stash will result in merge conflicts. To
recover from this, one easy way is to run `git reset --merge`. NOTE, however,
that this will return the index and the working tree to a completely clean
state--any staged or unstaged changes that were present before running
`git stash pop` will be lost.

# Preparing patches to submit to a mailing list

Some flags to `git-format-patch` which may be important to remember:

* `--reroll-count,-v`: Specify the version of the patch (e.g. v2)
* `--no-stat,-p`: Generates plain patches without any diffstat. This makes it easier
  for the kernel folks to read the patch.
* `--base=auto`: Automatically compute the base commit and add its object name as a
  tag in the patch
* `--cover-letter`: Create a cover letter patch to provide "frontmatter" for the
  email.

After generating the patches, the cover letter template generated by
`git-format-patch` needs to be filled in manually. Then, check the patches using
`scripts/checkpatch.pl`.

Some flags to `git-send-email` which may be important to remember:

* `--to-cmd`: Provide a command to obtain the addresses that should fill the `To:`
  field of the email. This is super useful for the kernel submission workflow. An
  example: `--to-cmd="scripts/get_maintainer.pl my.patch"`

# Tags

Sometimes, git doesn't fetch tags when `git pull` is run. Ensure that you're
fetching the correct remote by running `git fetch <remote>`. This helps in
multi-remote scenarios, such as Linux kernel development. If this still
doesn't work, try `git fetch --tags <remote>`.
